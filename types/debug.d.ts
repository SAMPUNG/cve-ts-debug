interface AggregatedStats {
  audioBitrate?: number
  audioBytesReceived?: number
  audioCodec?: string
  avgBitrate?: number
  avgframerate?: number
  bitrate?: number
  bytesReceivedStart?: number
  bytesReceived?: number
  codecs: Record<string, string>
  currentRoundTripTime?: number
  frameHeight?: number
  frameHeightStart?: number
  frameWidth?: number
  frameWidthStart?: number
  framerate?: number
  framesDecoded?: number
  framesDecodedStart?: number
  framesDropped?: number
  framesDroppedPercentage?: number
  framesReceived?: number
  highBitrate?: number
  highFramerate?: number
  lowBitrate?: number
  lowFramerate?: number
  packetsLost?: number
  receiveToCompositeMs?: number
  timestamp?: number
  timestampStart?: number
  videoCodec?: string
}

interface CveDebug extends HTMLElement {
  afk: DebugAFK
  freeze: DebugFreeze
  latency: DebugLatency
  refs: DebugRefs
  stats: DebugStats
}

interface DebugAFK {
  active: boolean
  closeTimeout: number
  countdown: number
  countdownTimer?: NodeJS.Timer
  enabled: boolean
  hideOverlay(): void
  overlay?: HTMLElement
  resetAfkWarningTimer(): void
  setOverlay(
    htmlClass: string,
    htmlElement?: HTMLElement,
    onClickFunction?: (ev: MouseEvent) => void
  ): void
  showAfkOverlay(): void
  startAfkWarningTimer(): void
  stopAfkWarningTimer(): void
  updateAfkOverlayText(): void
  warnTimeout: number
  warnTimer?: NodeJS.Timer
}

interface DebugFreeze {
  createOnScreenKeyboardHelpers(): void
  declare editTextButton: HTMLButtonElement
  declare height: number
  declare hiddenInput: HTMLInputElement
  invalidateFreezeFrameOverlay(): void
  declare jpeg?: Uint8Array
  get latency(): LatencyTest
  onDataChannelMessage(data: ArrayBuffer): void
  declare overlay: HTMLElement
  processFreezeFrameMessage(view: Uint8Array): void
  declare receiving: boolean
  get refs(): DebugRefs
  resizeFreezeFrameOverlay(): void
  setVideoEnabled(enabled: boolean): void
  setupFreezeFrameOverlay(): void
  setupHTMLEvents(): void
  showFreezeFrame(): void
  showFreezeFrameOverlay(): void
  showOnScreenKeyboard(command: ScreenCommand): void
  showPlayOverlay(): void
  declare size: number
  get stats(): DebugStats
  unquantizeAndDenormalizeUnsigned(x: number, y: number): { x: number, y: number }
  declare valid: boolean
  declare videoEncoderQP: number
  declare width: number
}

interface DebugLatency {
  declare browserReceiptTimeMs: number | null
  declare frameDisplayDeltaTimeMs: number | null
  onAllLatencyTimingsReady(): void
  get refs(): DebugRefs
  reset(): void
  setUETimings(ueTimings: UETimings): void
  setFrameDisplayDeltaTime(deltaTimeMs: number): void
  startLatencyTest(): void
  declare testStartTimeMs: number | null
  declare ueCaptureToSendMs: number | null
  declare ueEncodeMs: number | null
  declare uePostCaptureTimeMs?: number
  declare uePostEncodeTimeMs?: number
  declare uePreCaptureTimeMs?: number
  declare uePreEncodeTimeMs?: number
  declare ueReceiptTimeMs: number | null
  declare ueTransmissionTimeMs: number | null
}

interface DebugRefs {
  'cve-player-debug-panel': HTMLDivElement
  'debug-button': HTMLButtonElement
  'debug-command': HTMLInputElement
  'debug-data': HTMLTextAreaElement
  'debug-response': HTMLTextAreaElement
  'encoder-filler-data-tgl': HTMLInputElement
  'encoder-max-bitrate-text': HTMLInputElement
  'encoder-max-qp-text': HTMLInputElement
  'encoder-min-qp-text': HTMLInputElement
  'encoder-multipass': HTMLSelectElement
  'encoder-params-container': HTMLDivElement
  'encoder-params-submit': HTMLInputElement
  'encoder-rate-control': HTMLSelectElement
  'encoder-settings': HTMLElement
  'encoder-target-bitrate-text': HTMLInputElement
  'enlarge-display-to-fill-window-tgl': HTMLInputElement
  'fill-window': HTMLDivElement
  'kick-others': HTMLDivElement
  'kick-other-players-button': HTMLInputElement
  'latency-stats': HTMLDivElement
  'latency-stats-container': HTMLDivElement
  'latency-test': HTMLDivElement
  'latency-test-button': HTMLInputElement
  'match-viewport-resolution': HTMLDivElement
  'match-viewport-res-tgl': HTMLInputElement
  'overlay-button': HTMLDivElement
  'overlay-settings': HTMLDivElement
  'quality-control-ownership': HTMLDivElement
  'quality-control-ownership-tgl': HTMLInputElement
  'quality-status': HTMLDivElement
  'show-fps': HTMLDivElement
  'show-fps-button': HTMLInputElement
  'show-stats-tgl': HTMLInputElement
  'stats': HTMLDivElement
  'stats-container': HTMLDivElement
  'stats-panel': HTMLInputElement
  'webrtc-degradation-pref': HTMLSelectElement
  'webrtc-high-qp-text': HTMLInputElement
  'webrtc-low-qp-text': HTMLInputElement
  'webrtc-max-fps-text': HTMLInputElement
  'webrtc-max-bitrate-text': HTMLInputElement
  'webrtc-min-bitrate-text': HTMLInputElement
  'webrtc-params-container': HTMLDivElement
  'webrtc-params-submit': HTMLInputElement
  'webrtc-settings': HTMLElement

  get latency(): LatencyTest
  setupHTMLEvents(): void
}

interface DebugStats {
  aggregateStats(checkInterval: number): void
  audioBitrate?: number
  audioBytesReceived?: number
  audioCodec?: string
  avgBitrate?: number
  avgframerate?: number
  bitrate?: number
  bytesReceivedStart?: number
  bytesReceived?: number
  clear(): void
  close(): void
  declare codecs: Record<string, string>
  currentRoundTripTime?: number
  frameHeight?: number
  frameHeightStart?: number
  frameWidth?: number
  frameWidthStart?: number
  framerate?: number
  framesDecoded?: number
  framesDecodedStart?: number
  framesDropped?: number
  framesDroppedPercentage?: number
  framesReceived?: number
  highBitrate?: number
  highFramerate?: number
  get latency(): LatencyTest
  lowBitrate?: number
  lowFramerate?: number
  onAggregatedStats(aggregatedStats: AggregatedStats): void
  onStats(stats: RTCStatsReport): void
  packetsLost?: number
  declare printStats: boolean
  declare receivedBytes: number
  declare receivedBytesMeasurement: string
  receiveToCompositeMs?: number
  get refs(): DebugRefs
  declare timer: NodeJS.Timer | null
  timestamp?: number
  timestampStart?: number
  videoCodec?: string
  declare videoEncoderQP: number
}

interface ScreenCommand {
  command: string
  showOnScreenKeyboard?: boolean
  x: number
  y: number
}

interface UETimings {
  ReceiptTimeMs: number | null
  EncodeMs: number | null
  CaptureToSendMs: number | null
  TransmissionTimeMs: number | null
}
